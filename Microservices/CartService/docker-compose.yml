services:
  # app
    cart_app:
      build: .
      container_name: cart_service_container
      depends_on:
        - mongo
        - mongo-express
      ports:
        - "8085:8085"
      environment:
        SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/task4
        SPRING_DATASOURCE_USERNAME: postgres
        SPRING_DATASOURCE_PASSWORD: 1234
        SPRING_DATA_REDIS_HOST: redis_cache
        SPRING_DATA_REDIS_PORT: 6379

    # MongoDB
    mongo:
      image: mongo
      restart: always
      environment:
        MONGO_INITDB_ROOT_USERNAME: root
        MONGO_INITDB_ROOT_PASSWORD: example
        MONGO_INITDB_DATABASE: madamnofe5a
      ports:
        - "27017:27017"
      volumes:
        - cart_volume:/data/db

    # Mongo Express
    mongo-express:
      image: mongo-express
      restart: always
      ports:
        - "9000:8081"
      environment:
        ME_CONFIG_MONGODB_ADMINUSERNAME: root
        ME_CONFIG_MONGODB_ADMINPASSWORD: example
        ME_CONFIG_MONGODB_URL: mongodb://root:example@mongo:27017/
        ME_CONFIG_BASICAUTH: false
      depends_on:
        - mongo

volumes:
  cart_volume: